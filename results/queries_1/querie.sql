-- Quais os livros mais vendidos em Portugal

SELECT 
    BOOK.BOOK_ID,
    BOOK.TITLE,
    COUNTRY.COUNTRY_NAME,
    COUNT(CUST_ORDER.ORDER_ID) AS VENDAS
FROM 
    BOOK
    INNER JOIN ORDER_LINE ON BOOK.BOOK_ID = ORDER_LINE.BOOK_ID
    INNER JOIN CUST_ORDER ON ORDER_LINE.ORDER_ID = CUST_ORDER.ORDER_ID
    INNER JOIN ADDRESS ON CUST_ORDER.DEST_ADDRESS_ID = ADDRESS.ADDRESS_ID
    INNER JOIN COUNTRY ON ADDRESS.COUNTRY_ID = COUNTRY.COUNTRY_ID
WHERE 
    COUNTRY.COUNTRY_NAME = 'Portugal'
GROUP BY 
    BOOK.BOOK_ID, BOOK.TITLE, COUNTRY.COUNTRY_NAME
ORDER BY 
    VENDAS DESC;
